---
const { item, density = "card", topics = [], eventTypeLabel = "" } = Astro.props;

const SOURCE_SHORT_LABELS: Record<string, string> = {
  pboc: "PBOC",
  safe: "SAFE",
  csrc: "CSRC",
  nfra: "NFRA",
  mof_state_council: "MOF",
  mof: "MOF",
  nbs: "NBS",
  ecb: "ECB",
  boe: "BOE",
  federal_reserve: "FED",
  bis: "BIS",
};
const sourceFullName = item.source_name || item.source_id || "";
const sourceShort = SOURCE_SHORT_LABELS[String(item.source_id || "").toLowerCase()] || sourceFullName;

const published = new Date(item.published_at).toLocaleString("zh-CN", {
  year: "numeric",
  month: "2-digit",
  day: "2-digit",
  hour: "2-digit",
  minute: "2-digit",
});
const metaParts = [];
if (item.source_name) {
  metaParts.push(`Source: ${item.source_name}`);
}
if (item.content_type) {
  metaParts.push(item.content_type);
}
const regionLanguage = [item.region, item.language].filter(Boolean).join("/");
if (regionLanguage) {
  metaParts.push(regionLanguage);
}
const metaLine = metaParts.join(" · ");
---
{density === "compact" ? (
  <article class="border-b border-ink-900/10 py-2">
    <div class="flex flex-wrap items-baseline gap-x-3 gap-y-1">
      <span class="text-[11px] text-ink-900/60 tabular-nums">{published}</span>
      {eventTypeLabel && (
        <span class="rounded bg-ink-900/10 px-1.5 py-0.5 text-[10px] text-ink-900/70">
          {eventTypeLabel}
        </span>
      )}
      <a
        href={item.url}
        target="_blank"
        rel="noopener noreferrer"
        class="min-w-0 flex-1 text-sm font-medium text-ink-950 hover:text-accent-600 md:line-clamp-1"
      >
        {item.title}
      </a>
    </div>
    {(sourceFullName || topics.length > 0 || metaLine || item.summary) && (
      <div class="mt-1 flex flex-wrap items-center gap-x-3 gap-y-1 text-[11px] text-ink-900/60">
        {sourceFullName && (
          <span
            class="max-w-28 truncate rounded bg-ink-900/10 px-1.5 py-0.5 text-[10px] uppercase tracking-[0.18em] text-ink-900/70 sm:max-w-40"
            title={sourceFullName}
          >
            {sourceShort}
          </span>
        )}
        {topics.length > 0 && <span class="hidden md:inline">{topics.join(" · ")}</span>}
        {metaLine && <span class="hidden lg:inline">{metaLine}</span>}
        {item.summary && <span class="hidden xl:inline line-clamp-1">{item.summary}</span>}
      </div>
    )}
  </article>
) : (
  <article class="glass-panel rounded-2xl p-5 shadow-soft transition hover:-translate-y-1 hover:shadow-lg">
    <div class="flex flex-wrap items-center gap-3 text-xs text-ink-900/60">
      <span class="rounded-full bg-ink-900/10 px-3 py-1 text-[11px] uppercase tracking-[0.2em]">
        {item.source_name}
      </span>
      <span>{published}</span>
    </div>
    <h3 class="mt-3 text-lg font-semibold text-ink-950">
      <a href={item.url} target="_blank" rel="noopener noreferrer" class="hover:text-accent-600">
        {item.title}
      </a>
    </h3>
    {metaLine && <p class="mt-2 text-xs text-ink-900/60">{metaLine}</p>}
    {item.summary && <p class="mt-3 text-sm text-ink-900/70">{item.summary}</p>}
  </article>
)}
